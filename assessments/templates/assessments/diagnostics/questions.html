{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Questions • {{ child.first_name }}</title>
    <link rel="stylesheet" href="{% static 'core/design-system.css' %}">
    <style>
        .question-block { margin-bottom: 24px; }
        .dsj-answer { width: 100%; }
        .actions .dsj-cta { width: 100%; }
    </style>
</head>
<body class="dsj-shell">
    <header class="dsj-shell__header">
        <p class="dsj-eyebrow">Diagnostic Test</p>
        <h1 class="dsj-hero">{{ child.first_name }}'s Maths Journey</h1>
        <p class="dsj-copy">Pick one answer for each question, then submit.</p>
    </header>

    {% if errors %}
        <div class="dsj-card dsj-alert">
            <ul>
                {% for error in errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if saved %}
        <div class="dsj-card dsj-alert">Answers saved—come back anytime to finish.</div>
    {% endif %}
    {% if read_only %}
        <div class="dsj-card dsj-alert">This diagnostic is complete. Answers are read-only.</div>
    {% endif %}

    <section class="dsj-card">
        <form method="post">
            {% csrf_token %}
            {% for question in questions %}
                <article class="question-block">
                    <h2>Question {{ forloop.counter }}</h2>
                    <p>{{ question.question_text }}</p>
                    <ul class="dsj-answer-list">
                        {% for option, text in question.option_pairs %}
                            <li>
                                <label class="dsj-answer {% if question.selected_choice == option %}dsj-answer--selected{% endif %}">
                                    <span class="dsj-answer__letter">{{ option }}</span>
                                    <input type="radio"
                                           name="answer_{{ question.id }}"
                                           value="{{ option }}"
                                           {% if question.selected_choice == option %}checked{% endif %}
                                           {% if read_only %}disabled{% endif %}>
                                    <span>{{ text }}</span>
                                </label>
                            </li>
                        {% endfor %}
                    </ul>
                </article>
            {% empty %}
                <p>No questions available.</p>
            {% endfor %}
            <div class="actions" style="display:flex;flex-direction:column;gap:12px;margin-top:24px;">
                {% if read_only %}
                    <a class="dsj-cta" href="{% url 'assessments:diagnostic_results' test.id %}">View Results</a>
                {% else %}
                    <button class="dsj-cta" type="submit" name="action" value="save">Save Progress</button>
                    <button class="dsj-cta" type="submit" name="action" value="submit">Submit Test</button>
                {% endif %}
            </div>
        </form>
    </section>
</body>
</html>
