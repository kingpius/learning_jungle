## üéüÔ∏è Product Ticket: LJ-009 ‚Äî Deployment & Production Readiness (Heroku)

---

### üìå Ticket ID

LJ-009

---

### üßë‚Äçüíº Ownership & Roles

* **Primary Owner (Full Stack Engineer):** Full Stack Engineer
* **Product Manager:** PM (scope control, acceptance)
* **Test Owner:** Test Engineer (smoke test in production)
* **Design Owner:** ‚ùå Not required

---

### üéØ Objective

Deploy the Learning JUNGLE MVP to **Heroku** with a production-ready configuration so assessors can access a **live URL**.

This ticket focuses on **deployment, environment configuration, and reliability**. No feature work.

---

### üß© In Scope

* Create Heroku app
* Configure production settings
* Configure Postgres database
* Configure static file serving
* Configure environment variables/secrets
* Run migrations on Heroku
* Provide a working production URL
* Production smoke test of core MVP flow

---

### üö´ Out of Scope (Explicitly Excluded)

* New product features
* UI redesign
* Performance optimization beyond basic best practice
* CI/CD pipelines (optional)

---

### üß† Functional Requirements

#### 1. Heroku App Setup

* A Heroku application must be created (name aligned to project)
* GitHub or Heroku Git deployment must be configured

---

#### 2. Production Configuration

* Add required production dependencies:

  * `gunicorn`
  * `whitenoise` (or equivalent)
  * `dj-database-url`
  * `python-dotenv` (local only)
* Ensure `requirements.txt` is correct and up-to-date
* Create `Procfile` to run the web dyno

---

#### 3. Django Settings

* Configure production settings:

  * `DEBUG = False`
  * `ALLOWED_HOSTS` includes the Heroku domain
  * `SECRET_KEY` via env var
  * `DATABASE_URL` via env var
  * Secure session/cookie settings appropriate for production

---

#### 4. Static Assets

* Static assets must load correctly in production
* Use `whitenoise` (or equivalent) to serve static files
* Run `collectstatic` successfully

---

#### 5. Database & Migrations

* Use Heroku Postgres
* Run Django migrations successfully on Heroku
* Seed data optional (only if required to demo)

---

#### 6. Environment Variables

Set required variables in Heroku Config Vars (minimum):

* `SECRET_KEY`
* `DEBUG` (False)
* `ALLOWED_HOSTS`
* `DATABASE_URL` (provided by Heroku)
* AI variables if AI is enabled in prod:

  * `AI_PROVIDER`
  * `AI_API_KEY`
  * `AI_MODEL`

---

### üß™ Acceptance Criteria

| Scenario                                 | Expected Result                   |
| ---------------------------------------- | --------------------------------- |
| App deployed                             | Public URL reachable              |
| Home / entry route loads                 | No server errors                  |
| Parent auth works                        | Register/login/logout works       |
| Child diagnostic flow works              | Start ‚Üí answer ‚Üí submit ‚Üí results |
| AI generation works (or safely disabled) | No crashes                        |
| Static files load                        | CSS present in deployed pages     |
| Migrations complete                      | Database tables present           |

All criteria must pass for acceptance.

---

### üîê Non-Functional Requirements

* No secrets committed to Git
* Production configuration must be documented
* Clear runbook for local ‚Üí prod deployment

---

### üèóÔ∏è Technical Notes

* Recommend adding `runtime.txt` for Python version stability
* Recommend adding basic logging (stdout)
* If AI keys cannot be deployed, implement a safe fallback mode:

  * Disable AI and use cached or stub questions (only if needed)

---

### üß≠ Dependencies

* LJ-002 through LJ-008 complete ‚úÖ

---

### üèÅ Definition of Done

* Feature branch created: `feature/LJ-009-deployment`
* Heroku app deployed and stable
* URL shared and documented
* Smoke test checklist completed
* Pull Request opened, reviewed, and merged

---

### üö¶ Priority

P0 ‚Äî Submission readiness / delivery

---

### üöÄ Next Steps by Owner (Source of Truth)

#### ‚úÖ Full Stack Engineer (Primary Owner) ‚Äî Build + Deploy

1. **Branch + PR discipline**
   - Create branch: `feature/LJ-009-deployment`
   - Open PR early titled: `LJ-009: Heroku deployment readiness` and keep this ticket + PR description aligned.

2. **Production dependencies + entrypoint**
   - Ensure `requirements.txt` includes: `gunicorn`, `whitenoise`, `dj-database-url`
   - Ensure `python-dotenv` is **local/dev only** (do not require it in Heroku runtime)
   - Add `Procfile` with: `web: gunicorn config.wsgi`
   - Add `runtime.txt` to pin Python version

3. **Django production settings**
   - `DEBUG` via env var (default **False** in production)
   - `SECRET_KEY` via env var
   - `ALLOWED_HOSTS` via env var (must include Heroku app domain)
   - Configure Postgres via `DATABASE_URL` (use `dj-database-url`)
   - Secure defaults when `DEBUG=False`: `SECURE_SSL_REDIRECT`, `SESSION_COOKIE_SECURE`, `CSRF_COOKIE_SECURE` (HSTS optional but preferred)
   - Basic logging to stdout (Heroku-friendly)

4. **Static assets**
   - Configure WhiteNoise middleware + static storage
   - Confirm `collectstatic` succeeds on Heroku and CSS loads on all core pages

5. **AI in production (must not crash)**
   - Decision required in PR: AI **enabled** (with valid env vars) OR **safely disabled** (fallback mode)
   - If disabled: diagnostics must not 500; use cached/stub questions or show a clear, user-facing message

6. **Heroku deployment**
   - Create Heroku app + attach Postgres addon
   - Configure Heroku Config Vars (see below)
   - Deploy + run migrations
   - Post the live URL and a **config var name list (no secret values)** in PR

**Deliverable:** merged PR + live Heroku URL + short deploy/runbook note in repo.

---

#### ‚úÖ Test Engineer ‚Äî Release Gate + Production Smoke

1. **Pre-merge**
   - Run full test suite and post evidence in PR (command + pass confirmation)

2. **Post-deploy smoke (Heroku URL)**
   - Home route loads (no 500s)
   - Parent auth: register/login/logout works
   - Child diagnostic: start ‚Üí answer ‚Üí submit ‚Üí results
   - Completed test revisit is read-only (cannot restart)
   - Static assets load (design-system CSS present)
   - AI path: either works **or** is safely disabled (no crashes)

3. **Verification matrix**
   - Add a short PASS/FAIL matrix in the PR with notes/screenshots as needed

**Deliverable:** ‚ÄúGo/No-Go‚Äù comment in PR after production smoke.

---

#### ‚úÖ Product Designer ‚Äî Not Required (Optional Visual Sanity)

- Optional 10-minute check on the deployed URL: readability, layout not broken, CSS loaded.
- If issues found, file a follow-up ticket (no design work required in LJ-009).

---

#### ‚úÖ PM ‚Äî Scope Control + Acceptance

- Confirm scope remains deployment-only (no feature work).
- Approve merge only after: live URL posted, migrations run, static assets verified, and Test Engineer smoke PASS.
- Capture any follow-ups (CI/CD, monitoring, AI curriculum retrieval) as separate tickets.

---

### üîê Heroku Config Vars (Names Only)

Minimum required:
- `SECRET_KEY`
- `DEBUG` = `False`
- `ALLOWED_HOSTS` (must include `<app>.herokuapp.com`)
- `DATABASE_URL` (set by Heroku Postgres)

If AI enabled in prod:
- `AI_PROVIDER_URL`
- `AI_API_KEY`
- `AI_MODEL`
- `AI_TIMEOUT_SECONDS`

---

### ‚úÖ PR Checklist (Paste into PR)

- [ ] `Procfile` + `runtime.txt` added
- [ ] `requirements.txt` updated (`gunicorn`, `whitenoise`, `dj-database-url`)
- [ ] Production settings env-driven (`DEBUG=False`, `SECRET_KEY`, `ALLOWED_HOSTS`, `DATABASE_URL`)
- [ ] WhiteNoise configured; `collectstatic` succeeds; CSS loads
- [ ] Heroku Postgres attached; migrations run successfully
- [ ] Live URL posted in PR
- [ ] AI either works with env vars OR safely disabled (no 500s)
- [ ] Test Engineer smoke PASS with verification matrix

---

### üîÑ Updates & Coordination Log

**Update YYYY-MM-DD ‚Äî PM**
- (Add decision notes and acceptance sign-off here.)

**Update 2025-12-17 ‚Äî Full Stack Engineer**
- Added Heroku entrypoint files: `Procfile` (`gunicorn config.wsgi`) and `runtime.txt` (pins Python).
- Updated `requirements.txt` for production (`dj-database-url`) and moved `python-dotenv` to `requirements-dev.txt`; `.env` loading is optional and never required on Heroku.
- Updated `config/settings.py` to be env-driven (DEBUG/SECRET_KEY/ALLOWED_HOSTS/DATABASE_URL), Heroku-friendly security defaults when `DEBUG=False`, and stdout logging.
- Configured static asset serving via WhiteNoise (`WhiteNoiseMiddleware`, `STATIC_ROOT`, compressed manifest storage).
- Implemented AI ‚Äúno-crash‚Äù behavior for production: `AI_FALLBACK_MODE=stub` on Heroku by default so diagnostics can run even if AI keys aren‚Äôt set (configurable via env).
- Added deployment runbook: `DEPLOYMENT.md` (setup steps, config var names, deploy + smoke checklist).
- Local validation: `./venv/bin/python manage.py collectstatic --noinput` succeeds; `DEBUG=False ./venv/bin/python manage.py check --deploy` shows only expected warning if `SECRET_KEY` env var is not set.

**Update 2025-12-17 ‚Äî Full Stack Engineer (Heroku Deploy Fix)**
- Heroku GitHub build failed because the repo currently tracks `.venv/` (a committed local virtualenv). Heroku‚Äôs Python buildpack expects to create its own runtime/venv during compile and can fail when a virtualenv is present in the repo.
- Added `.slugignore` to exclude `.venv/`, `venv/`, `db.sqlite3`, and `staticfiles/` from Heroku slugs, but the primary fix is to remove `.venv/` from Git tracking and push.
- Action for repo owner: run the following once, commit, and redeploy:
  - `git rm -r --cached .venv`
  - `git commit -m "LJ-009: remove committed virtualenv"`
  - `git push`

**Update 2025-12-17 ‚Äî Full Stack Engineer (Buildpack Fix)**
- Heroku buildpack defaulted to Python 3.14 and failed `collectstatic` with `STATIC_ROOT` missing, indicating the deployment branch didn‚Äôt include the latest production settings changes.
- Added `.python-version` (Heroku-24 recommended) to pin Python to `3.12` (major/minor only, keeps security updates flowing).
- Reminder: ensure the deployed branch contains `STATIC_ROOT` + WhiteNoise settings and `requirements.txt` includes `dj-database-url` (and does not require `python-dotenv`) before re-deploying.

(.venv) apples-iMac:learning_jungle piusbozumbil$ git checkout -b feature/LJ-009-deployment
Switched to a new branch 'feature/LJ-009-deployment'
(.venv) apples-iMac:learning_jungle piusbozumbil$ 
